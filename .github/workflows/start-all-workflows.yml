name: Start All Workflows

on:
  workflow_dispatch:

permissions:
  contents: write
  actions: write

jobs:
  trigger-all:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Cleanup old workflow runs
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ§¹ Membersihkan workflow runs lama..."
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          # Hapus run yang gagal
          gh run list -R ${{ github.repository }} --status failure --json databaseId -q '.[].databaseId' 2>/dev/null | while read id; do
            gh run delete -R ${{ github.repository }} "$id" 2>/dev/null || true
          done
          
          # Hapus run yang dibatalkan
          gh run list -R ${{ github.repository }} --status cancelled --json databaseId -q '.[].databaseId' 2>/dev/null | while read id; do
            gh run delete -R ${{ github.repository }} "$id" 2>/dev/null || true
          done
          
          echo "âœ… Cleanup selesai!"

      - name: Trigger Profile Dynamic Updater
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "ğŸš€ Triggering Profile Dynamic Updater..."
          gh workflow run "Profile Dynamic Updater" -R ${{ github.repository }} || echo "âš ï¸ Workflow tidak ditemukan"

      - name: Trigger Random Anime Card
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "ğŸŒ Triggering Random Anime Card..."
          gh workflow run "Update Random Anime Card" -R ${{ github.repository }} || echo "âš ï¸ Workflow tidak ditemukan"

      - name: Trigger Snake Animation
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "ğŸ Triggering Snake Animation..."
          gh workflow run "Generate Snake Animation" -R ${{ github.repository }} || echo "âš ï¸ Workflow tidak ditemukan"

      - name: Trigger Blog Posts
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "ğŸ“ Triggering Blog Posts..."
          gh workflow run "Latest Blog Posts" -R ${{ github.repository }} || echo "âš ï¸ Workflow tidak ditemukan"

      - name: Trigger WakaTime Stats
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "â±ï¸ Triggering WakaTime Stats..."
          gh workflow run "WakaTime Stats" -R ${{ github.repository }} || echo "âš ï¸ Workflow tidak ditemukan"

      - name: Trigger Update Contributors
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "ğŸ‘¥ Triggering Update Contributors..."
          gh workflow run "Update Contributors by Recent Activity" -R ${{ github.repository }} || echo "âš ï¸ Workflow tidak ditemukan"

      - name: Trigger Clock Updater
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "ğŸ• Triggering Clock Updater..."
          gh workflow run "Update Clock Badge" -R ${{ github.repository }} || echo "âš ï¸ Workflow tidak ditemukan"

      - name: Summary
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Semua workflow berhasil dipicu!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Workflow yang dijalankan:"
          echo "  1. Profile Dynamic Updater (Rotasi Header)"
          echo "  2. Update Random Anime Card (Karakter Anime)"
          echo "  3. Generate Snake Animation (Animasi Ular)"
          echo "  4. Latest Blog Posts (Blog Post)"
          echo "  5. WakaTime Stats (Statistik Coding)"
          echo "  6. Update Contributors (Daftar Kontributor)"
          echo "  7. Update Clock Badge (Jam WITA)"
          echo ""
          echo "ğŸ“Š Cek tab Actions untuk melihat status masing-masing workflow."
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"